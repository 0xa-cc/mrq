
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="MRQ">
    <meta name="author" content="pricing assistant">
    <link rel="icon" href="images/favicon.ico" type="image/x-icon" />

    <title>MRQ - Mongo Redis Queue</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">

    <!-- Custom styles for this template -->
    <link href="css/jumbotron-narrow.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>

    <div class="container">
      <div class="header">
        <nav>
          <ul class="nav nav-pills pull-right">
            <li role="presentation"><a href="http://mrq.readthedocs.org/en/latest/">docs</a></li>
            <li role="presentation">
              <a href="https://github.com/pricingassistant/mrq">github</a>
            </li>
            <li role="presentation">
              <a href="https://pypi.python.org/pypi/mrq">pypi</a>
            </li>
          </ul>
          <div class="clearfix"></div>
        </nav>
      </div>

      <div class="jumbotron">
        <h1>MR<img src="images/mrq-icon.png" /></h1>
        <p class="lead">A simple yet powerful <br />distributed worker task queue in Python <br /><br />built with <b>Mongo</b>, <b>Redis</b> and <b>gevent</b>.</p>
        <p>
          <a class="btn btn-lg btn-success" href="http://mrq.readthedocs.org/en/latest/get-started" role="button">
            Get Started
          </a>
        </p>
        <h5 class="subtitle">
          Current version is 0.1.5
        </h5>
      </div>

      <div class="row marketing"><h1>Intro</h1>
<p><a href="http://pricingassistant.github.io/mrq">MRQ</a> is a distributed task queue for python built on top of mongo, redis and gevent.</p>
<p>Full documentation is available on <a href="http://mrq.readthedocs.org/en/latest/">readthedocs</a></p>
<p>/!\ MRQ is not yet ready for public use. Soon!</p>
<h1>Why?</h1>
<p>MRQ is an opinionated task queue. It aims to be simple and beautiful like <a href="http://python-rq.org">RQ</a> while having performances close to <a href="http://celeryproject.org">Celery</a></p>
<p>MRQ was first developed at <a href="http://pricingassistant.com">Pricing Assistant</a> and its initial feature set matches the needs of worker queues with heterogenous jobs (IO-bound &amp; CPU-bound, lots of small tasks &amp; a few large ones).</p>
<h1>Main Features</h1>
<ul>
<li><strong>Simple code:</strong> We originally switched from Celery to RQ because Celery's code was incredibly complex and obscure (<a href="http://www.slideshare.net/sylvinus/why-and-how-pricing-assistant-migrated-from-celery-to-rq-parispy-2">Slides</a>). MRQ should be as easy to understand as RQ and even easier to extend.</li>
<li><strong>Great <a href="http://mrq.readthedocs.org/en/latest/dashboard/">dashboard</a>:</strong> Have visibility and control on everything: queued jobs, current jobs, worker status, ...</li>
<li><strong>Per-job logs:</strong> Get the log output of each task separately in the dashboard</li>
<li><strong>Gevent worker:</strong> IO-bound tasks can be done in parallel in the same UNIX process for maximum throughput</li>
<li><strong>Supervisord integration:</strong> CPU-bound tasks can be split across several UNIX processes with a single command-line flag</li>
<li><strong>Job management:</strong> You can retry, requeue, cancel jobs from the code or the dashboard.</li>
<li><strong>Performance:</strong> Bulk job queueing, easy job profiling</li>
<li><strong>Easy <a href="http://mrq.readthedocs.org/en/latest/configuration">configuration</a>:</strong> Every aspect of MRQ is configurable through command-line flags or a configuration file</li>
<li><strong>Job routing:</strong> Like Celery, jobs can have default queues, timeout and ttl values.</li>
<li><strong>Thorough <a href="http://mrq.readthedocs.org/en/latest/tests">testing</a>:</strong> Edge-cases like worker interrupts, Redis failures, ... are tested inside a Docker container.</li>
<li><strong>Builtin scheduler:</strong> Schedule tasks by interval or by time of the day</li>
<li><strong>Greenlet tracing:</strong> See how much time was spent in each greenlet to debug CPU-intensive jobs.</li>
<li><strong>Integrated memory leak debugger:</strong> Track down jobs leaking memory and find the leaks with objgraph.</li>
</ul>
<h1>Dashboard</h1>
<p>A strong focus was put on the tools and particularly the dashboard. After all it is what you will work with most of the time!</p>
<p><img src="http://i.imgur.com/H2nsgq2.png" alt="Queues view"></p>
<p><img src="http://i.imgur.com/SNsYhuQ.png" alt="Jobs view"></p>
<h4>How to run</h4>
<p>To run the dashboard, make sur that mrq is properly installed. Then, use the
following command:</p>
<pre><code class="lang-bash">mrq-dashboard
</code></pre>
<p>The Dashboard will be available on the <code>5555</code> port (<a href="http://localhost:5555">http://localhost:5555</a>).</p>
<h4>Main goal</h4>
<p>There are too many features on the dashboard to list, but the goal is to have complete visibility and control over what your workers are doing!</p>
<h1>Get started</h1>
<p>This 5-minute tutorial will show you how to run your first jobs with MRQ.</p>
<h2>Installation</h2>
<ul>
<li>Make sure you have installed the <a href="dependencies.md">dependencies</a> : Redis and MongoDB</li>
<li>Install MRQ with <code>pip install mrq</code></li>
<li>Start a mongo server with <code>mongod &amp;</code></li>
<li>Start a redis server with <code>redis-server &amp;</code></li>
</ul>
<h2>Write your first task</h2>
<p>Create a new directory and write a simple task in a file called <code>tasks.py</code> :</p>
<pre><code class="lang-makefile">$ mkdir test-mrq &amp;&amp; cd test-mrq
$ touch __init__.py
$ vim tasks.py
</code></pre>
<pre><code class="lang-python">from mrq.task import Task
import urllib2


class Fetch(Task):

    def run(self, params):

        with urllib2.urlopen(params[&quot;url&quot;]) as f:
          t = f.read()
          return len(t)
</code></pre>
<h2>Run it synchronously</h2>
<p>You can now run it from the command line using <code>mrq-run</code>:</p>
<pre><code class="lang-makefile">$ mrq-run tasks.Fetch url http://www.google.com

2014-12-18 15:44:37.869029 [DEBUG] mongodb_jobs: Connecting to MongoDB at 127.0.0.1:27017/mrq...
2014-12-18 15:44:37.880115 [DEBUG] mongodb_jobs: ... connected.
2014-12-18 15:44:37.880305 [DEBUG] Starting tasks.Fetch({&#39;url&#39;: &#39;http://www.google.com&#39;})
2014-12-18 15:44:38.158572 [DEBUG] Job None success: 0.278229s total
17655
</code></pre>
<h2>Run it asynchronously</h2>
<p>Let's schedule the same task 3 times with different parameters:</p>
<pre><code class="lang-makefile">$ mrq-run --queue fetches tasks.Fetch url http://www.google.com &amp;&amp;
  mrq-run --queue fetches tasks.Fetch url http://www.yahoo.com &amp;&amp;
  mrq-run --queue fetches tasks.Fetch url http://www.wordpress.com

2014-12-18 15:49:05.688627 [DEBUG] mongodb_jobs: Connecting to MongoDB at 127.0.0.1:27017/mrq...
2014-12-18 15:49:05.705400 [DEBUG] mongodb_jobs: ... connected.
2014-12-18 15:49:05.729364 [INFO] redis: Connecting to Redis at 127.0.0.1...
5492f771520d1887bfdf4b0f
2014-12-18 15:49:05.957912 [DEBUG] mongodb_jobs: Connecting to MongoDB at 127.0.0.1:27017/mrq...
2014-12-18 15:49:05.967419 [DEBUG] mongodb_jobs: ... connected.
2014-12-18 15:49:05.983925 [INFO] redis: Connecting to Redis at 127.0.0.1...
5492f771520d1887c2d7d2db
2014-12-18 15:49:06.182351 [DEBUG] mongodb_jobs: Connecting to MongoDB at 127.0.0.1:27017/mrq...
2014-12-18 15:49:06.193314 [DEBUG] mongodb_jobs: ... connected.
2014-12-18 15:49:06.209336 [INFO] redis: Connecting to Redis at 127.0.0.1...
5492f772520d1887c5b32881
</code></pre>
<p>You can see that instead of executing the tasks and returning their results right away, <code>mrq-run</code> has added them to the queue named <code>fetches</code> and printed their IDs.</p>
<p>Now start MRQ's dasbhoard with <code>mrq-dashboard &amp;</code> and go check your newly created queue and jobs on <a href="http://localhost:5555/#jobs">localhost:5555</a></p>
<p>They are ready to be dequeued by a worker. Start one with <code>mrq-worker</code> and follow it on the dashboard as it executes the queued jobs in parallel.</p>
<pre><code class="lang-makefile">$ mrq-worker fetches

2014-12-18 15:52:57.362209 [INFO] Starting Gevent pool with 10 worker greenlets (+ report, logs, adminhttp)
2014-12-18 15:52:57.388033 [INFO] redis: Connecting to Redis at 127.0.0.1...
2014-12-18 15:52:57.389488 [DEBUG] mongodb_jobs: Connecting to MongoDB at 127.0.0.1:27017/mrq...
2014-12-18 15:52:57.390996 [DEBUG] mongodb_jobs: ... connected.
2014-12-18 15:52:57.391336 [DEBUG] mongodb_logs: Connecting to MongoDB at 127.0.0.1:27017/mrq...
2014-12-18 15:52:57.392430 [DEBUG] mongodb_logs: ... connected.
2014-12-18 15:52:57.523329 [INFO] Fetching 1 jobs from [&#39;fetches&#39;]
2014-12-18 15:52:57.567311 [DEBUG] Starting tasks.Fetch({u&#39;url&#39;: u&#39;http://www.google.com&#39;})
2014-12-18 15:52:58.670492 [DEBUG] Job 5492f771520d1887bfdf4b0f success: 1.135268s total
2014-12-18 15:52:57.523329 [INFO] Fetching 1 jobs from [&#39;fetches&#39;]
2014-12-18 15:52:57.567747 [DEBUG] Starting tasks.Fetch({u&#39;url&#39;: u&#39;http://www.yahoo.com&#39;})
2014-12-18 15:53:01.897873 [DEBUG] Job 5492f771520d1887c2d7d2db success: 4.361895s total
2014-12-18 15:52:57.523329 [INFO] Fetching 1 jobs from [&#39;fetches&#39;]
2014-12-18 15:52:57.568080 [DEBUG] Starting tasks.Fetch({u&#39;url&#39;: u&#39;http://www.wordpress.com&#39;})
2014-12-18 15:53:00.685727 [DEBUG] Job 5492f772520d1887c5b32881 success: 3.149119s total
2014-12-18 15:52:57.523329 [INFO] Fetching 1 jobs from [&#39;fetches&#39;]
2014-12-18 15:52:57.523329 [INFO] Fetching 1 jobs from [&#39;fetches&#39;]
</code></pre>
<p>You can interrupt the worker with Ctrl-C once it is finished.</p>
<h2>Going further</h2>
<p>This was a preview on the very basic features of MRQ. What makes it actually useful is that:</p>
<ul>
<li>You can run multiple workers in parallel. Each worker can also run multiple greenlets in parallel.</li>
<li>Workers can dequeue from multiple queues</li>
<li>You can queue jobs from your Python code to avoid using <code>mrq-run</code> from the command-line.</li>
</ul>
<p>These features will be demonstrated in a future example of a simple web crawler.</p>
</div><!-- row marketing -->
      <div class="row marketing">
        <h1>More</h1>
        <p>
          Full documentation is available on
          <a href="http://mrq.readthedocs.org/en/latest/">readthedocs</a>
        </p>
      </div>

      <footer class="footer">
        <ul class="list-inline">
          <li class="pull-right">
            <iframe
              src="http://ghbtns.com/github-btn.html?user=pricingassistant&repo=mrq&type=fork&count=true"
              allowtransparency="true"
              frameborder="0"
              scrolling="0"
              width="80"
              height="25">
            </iframe>
          </li>
          <li class="pull-right">
            <iframe
              src="http://ghbtns.com/github-btn.html?user=pricingassistant&repo=mrq&type=watch&count=true"
              allowtransparency="true"
              frameborder="0"
              scrolling="0"
              width="100"
              height="25">
            </iframe>
          </li>
          <li class="pull-right">
            <a href="https://pypi.python.org/pypi/mrq">pypi package</a>
          </li>
          <li>
            <p>
              built by
              <a href="http://www.pricingassistant.com">
                Pricing Assistant
              </a>
            </p>
          </li>
        </ul>
      </footer>

    </div> <!-- /container -->
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
  </body>
</html>
